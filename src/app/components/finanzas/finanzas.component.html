<div class="finz">
  <!-- HEADER -->
  <header class="finz__header" role="heading" aria-level="1">FINANZAS</header>

  <!-- KPI superiores (GLOBAL/GENERAL) -->
  <section class="kpis" aria-label="Indicadores globales">
    <div class="kpi">
      <label>Total de Ingresos</label>
      <div class="kinput">Q {{ totIngresos | number:'1.2-2' }}</div>
    </div>
    <div class="kpi">
      <label>Total de Egresos</label>
      <div class="kinput">Q {{ totEgresos | number:'1.2-2' }}</div>
    </div>
    <div class="kpi">
      <label>Saldo</label>
      <div class="kinput">Q {{ totSaldo | number:'1.2-2' }}</div>
    </div>
  </section>

  <!-- TESORERÍAS -->
  <section class="tre" aria-label="Tesorerías">
    <!-- Fila 1: chips centrados -->
    <div class="tre__chips" role="tablist" aria-label="Filtro por estado">
      <button class="chip chip--gray"  (click)="setStatusFilter('Inactivo')" aria-label="Mostrar inactivos">Inactivo</button>
      <button class="chip chip--green" (click)="setStatusFilter('Activo')"   aria-label="Mostrar activos">Activo</button>
      <button class="chip chip--light" (click)="setStatusFilter('Todos')"    aria-label="Mostrar todos">Todo</button>
    </div>

    <!-- Fila 2: Acciones + búsqueda -->
    <div class="tre__toolbar">
      <div class="toolbar-left">
        <button class="toolbar-btn" type="button" (click)="openAddTesoreria()" aria-label="Agregar tesorería">
          + Agregar Tesorería
        </button>

        <button class="toolbar-btn" type="button" *ngIf="isPastor" (click)="openDiezmos()" aria-label="Abrir diezmos">
          Diezmos
        </button>
      </div>

      <div class="right">
        <!-- Selector de Mes (solo MM/yyyy) -->
        <mat-form-field appearance="outline" class="month-field" style="width: 140px;">
          <mat-label>Mes</mat-label>

          <!-- Input visible -->
          <input
            class="month-display-input"
            [value]="displayMonth"
            aria-label="Mes seleccionado"
            placeholder="MM/AAAA"
            readonly
            (click)="pickerMes.open()"
          />

          <!-- Botón para abrir el calendario -->
          <button mat-icon-button matSuffix type="button" (click)="pickerMes.open()" aria-label="Abrir selector de mes">
            <mat-icon>event</mat-icon>
          </button>

          <!-- Input oculto al que se ancla el mat-datepicker -->
          <input
            matInput
            [matDatepicker]="pickerMes"
            class="visually-hidden-input"
            [max]="maxMonth"
            tabindex="-1"
            aria-hidden="true"
          />

          <!-- Calendario de selección de mes -->
          <mat-datepicker
            #pickerMes
            startView="multi-year"
            [startAt]="monthCtrl.value"
            (monthSelected)="chosenMonthHandler($event, pickerMes)">
          </mat-datepicker>
        </mat-form-field>

        <!-- Botón de descarga -->
        <button class="btn btn--excel" type="button" (click)="downloadReporte()" aria-label="Descargar reporte PDF">
          <mat-icon aria-hidden="true">download</mat-icon>
          <span>Descargar Reporte</span>
        </button>

        <!-- Buscador -->
        <label class="search" aria-label="Buscar tesorería">
          <mat-icon aria-hidden="true">search</mat-icon>
          <input [formControl]="searchTreas" placeholder="Buscar" aria-label="Buscar" />
          <button type="button" *ngIf="searchTreas.value" (click)="searchTreas.setValue('')" aria-label="Limpiar búsqueda">
            <mat-icon aria-hidden="true">close</mat-icon>
          </button>
        </label>
      </div>
    </div>

    <!-- Tabla -->
    <div class="tre__table" role="region" aria-label="Listado de tesorerías">
      <table mat-table [dataSource]="treasuries" class="mat-elevation-z0" aria-label="Tabla de tesorerías">
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef> Tesorería </th>
          <td mat-cell *matCellDef="let t">
            <a class="tre-link" (click)="selectTreasury(t)">{{ t.name }}</a>
          </td>
        </ng-container>

        <ng-container matColumnDef="ingresos">
          <th mat-header-cell *matHeaderCellDef> Ingresos </th>
          <td mat-cell *matCellDef="let t">Q {{ t.incomes | number:'1.2-2' }}</td>
        </ng-container>

        <ng-container matColumnDef="egresos">
          <th mat-header-cell *matHeaderCellDef> Egresos </th>
          <td mat-cell *matCellDef="let t">Q {{ t.expenses | number:'1.2-2' }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedTreColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedTreColumns"></tr>
      </table>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <button mat-stroked-button color="primary" type="button" (click)="regresar()">Regresar</button>
  </footer>
</div>
